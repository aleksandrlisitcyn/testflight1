<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ title }}</title>
    <style>
        @page { margin: 24pt; }
        body { font-family: "DejaVu Sans", Arial, sans-serif; color: #111; }
        header { border-bottom: 2px solid #333; margin-bottom: 12pt; padding-bottom: 6pt; }
        header h1 { font-size: 20pt; margin: 0; }
        header .meta { font-size: 10pt; color: #555; }

        .section { margin-bottom: 18pt; }
        .section h2 { font-size: 14pt; margin: 0 0 6pt; border-bottom: 1px solid #999; padding-bottom: 4pt; }

        .summary-grid { width: 100%; border-collapse: collapse; font-size: 10pt; }
        .summary-grid td { padding: 4pt 6pt; border: 1px solid #ccc; }
        .summary-grid td.label { font-weight: 600; background: #f4f4f4; }

        .previews { display: flex; gap: 12pt; }
        .preview { flex: 1; text-align: center; }
        .preview img { max-width: 100%; border: 1px solid #ccc; }
        .preview figcaption { font-size: 9pt; margin-top: 4pt; color: #444; }

        table.legend { width: 100%; border-collapse: collapse; font-size: 9pt; }
        table.legend th, table.legend td { border: 1px solid #bbb; padding: 4pt 6pt; }
        table.legend th { background: #f0f0f0; font-size: 9pt; }
        table.legend td.swatch { width: 40pt; }
        table.legend td.swatch .color-box { display: block; width: 100%; height: 16pt; border: 1px solid #777; }
        table.legend td.symbol { font-family: "DejaVu Sans Mono", monospace; text-align: center; font-size: 10pt; }
        table.legend td.count { text-align: right; }
        table.legend td.percent { text-align: right; color: #666; }

        footer { margin-top: 24pt; font-size: 8pt; color: #777; text-align: right; }
    </style>
</head>
<body>
    <header>
        <h1>{{ title }}</h1>
        <div class="meta">
            Brand: {{ brand }} · Grid: {{ grid.width }} × {{ grid.height }} · Total stitches: {{ total_stitches }}
            {% if palette_size %}· Palette: {{ palette_size }} colours{% endif %}
        </div>
    </header>

    <section class="section">
        <h2>Summary</h2>
        <table class="summary-grid">
            <tr>
                <td class="label">Canvas size</td>
                <td>{{ grid.width }} × {{ grid.height }} cells</td>
                <td class="label">Estimated dimensions</td>
                <td>{{ estimated_size.cm_width }} × {{ estimated_size.cm_height }} cm ({{ stitch_per_cm }} st/cm)</td>
            </tr>
            <tr>
                <td class="label">Palette</td>
                <td>{{ palette_size }} colours</td>
                <td class="label">Most used colour</td>
                <td>{% if legend %}{{ legend[0].brand }} {{ legend[0].code }} — {{ legend[0].name or '—' }} ({{ legend[0].count }} stitches){% else %}—{% endif %}</td>
            </tr>
        </table>
    </section>

    <section class="section">
        <h2>Previews</h2>
        <div class="previews">
            <figure class="preview">
                <img src="data:image/png;base64,{{ previews.color }}" alt="Colour preview">
                <figcaption>Colour blocks</figcaption>
            </figure>
            <figure class="preview">
                <img src="data:image/png;base64,{{ previews.symbols }}" alt="Symbol preview">
                <figcaption>Symbols with grid</figcaption>
            </figure>
        </div>
    </section>

    <section class="section">
        <h2>Legend</h2>
        <table class="legend">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Brand</th>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Symbol</th>
                    <th class="swatch">Colour</th>
                    <th class="count">Stitches</th>
                    <th class="percent">%</th>
                </tr>
            </thead>
            <tbody>
            {% for row in legend %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ row.brand }}</td>
                    <td>{{ row.code }}</td>
                    <td>{{ row.name or '—' }}</td>
                    <td class="symbol">{{ row.symbol or '•' }}</td>
                    <td class="swatch"><span class="color-box" style="background: {{ row.hex }};"></span></td>
                    <td class="count">{{ row.count }}</td>
                    <td class="percent">{{ '%.2f'|format(row.percent) }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </section>

    <footer>Generated by Stitch Converter</footer>
</body>
</html>
